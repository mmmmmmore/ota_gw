<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>OTA Gateway HUT UI</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #eee;
      display: flex;
      height: 100vh;
    }
    .sidebar {
      width: 200px;
      background-color: #222;
      display: flex;
      flex-direction: column;
      padding-top: 20px;
    }
    .menu-item {
      padding: 15px;
      cursor: pointer;
      border-bottom: 1px solid #333;
    }
    .menu-item:hover { background-color: #444; }
    .content {
      flex: 1;
      padding: 20px;
      background-color: #1a1a1a;
    }
    .hidden { display: none; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    table, th, td { border: 1px solid #555; }
    th, td { padding: 8px; text-align: center; }

    /* Buttons */
    button { padding: 6px 12px; border: none; color: #fff; }
    .btn-disabled { background-color: grey; cursor: not-allowed; }
    .btn-active { background-color: green; cursor: pointer; }
    .btn-primary { background-color: #0a84ff; }
    .btn-primary:hover { background-color: #0066cc; }

    /* Modal */
    #modal {
      display: none;
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translateX(-50%);
      width: 480px;
      background: #fff;
      color: #000;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.4);
      padding: 20px;
      z-index: 1000;
    }
    #modal-header {
      display: flex; justify-content: space-between; align-items: center;
      border-bottom: 1px solid #e5e5e5; padding-bottom: 10px; margin-bottom: 12px;
    }
    #modal-close { background: transparent; color: #333; cursor: pointer; }
    #modal-actions { display: flex; gap: 10px; margin-top: 12px; }

    /* Dual-color progress bar */
    .progress-container {
      width: 100%; height: 16px; background-color: #bbb; border-radius: 8px;
      overflow: hidden; margin-top: 12px;
    }
    .progress-fill {
      height: 100%;
      width: 0%;
      background-color: green; /* completed */
      transition: width 0.3s ease;
    }
    .progress-text { margin-top: 8px; font-size: 14px; color: #333; }
    .note { color: #666; font-size: 12px; margin-top: 6px; }
  </style>
</head>
<body>
  <!-- 左侧菜单栏 -->
  <div class="sidebar">
    <div class="menu-item" onclick="showContent('Navigation')">Navigation</div>
    <div class="menu-item" onclick="showContent('radio')">radio</div>
    <div class="menu-item" onclick="showContent('game')">Game</div>
    <div class="menu-item" onclick="showContent('system')">System</div>
    <div class="menu-item" onclick="showContent('version')">Update</div>
  </div>

  <!-- 右侧功能区 -->
  <div class="content">
    <div id="Navigation" class="section">
      <h2>Navigation</h2>
      <img src="Navigation.png" alt="Location Navigation">
    </div>

    <div id="radio" class="section hidden">
      <h2>radio</h2>
      <img src="radio.png" alt="Radio">
    </div>

    <div id="game" class="section hidden">
      <h2>Game</h2>
      <img src="Game.png" alt="Game">
    </div>

    <div id="system" class="section hidden">
      <h2>System Information</h2>
      <p>Current Version: 1.0.0</p>
      <p>Description: 网关节点, 负责OTA任务转发与状态管理。</p>
    </div>

    <!-- 版本查询 -->
    <div id="version" class="section hidden">
      <h2>版本查询</h2>
      <table>
        <thead>
          <tr>
            <th>Client 名称</th>
            <th>当前版本</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody id="client-list">
          <tr>
            <td>Client_1</td>
            <td>v1.0.0</td>
            <td>
              <button id="checkUpdateBtn" class="btn-disabled" disabled>检查更新</button>
              &nbsp;
              <button id="simulateOtaBtn" class="btn-primary">模拟 OTA 推送</button>
            </td>
          </tr>
        </tbody>
      </table>
      <p class="note">说明：测试用途的“模拟 OTA 推送”将激活“检查更新”，并在弹窗中执行20秒的进度演示。</p>
    </div>
  </div>

  <!-- 弹窗：版本信息 + 接受/拒绝 + 进度展示 -->
  <div id="modal">
    <div id="modal-header">
      <h3>版本更新</h3>
      <button id="modal-close" onclick="closeModal()">✕</button>
    </div>
    <div id="taskInfo"></div>
    <div id="modal-actions">
      <button id="acceptBtn" class="btn-active" onclick="onAccept()">Accept</button>
      <button id="denyBtn" class="btn-primary" onclick="onDeny()">Deny</button>
    </div>

    <!-- Progress (green completed, gray remaining) -->
    <div class="progress-container" id="progressContainer" style="display:none;">
      <div class="progress-fill" id="progressFill"></div>
    </div>
    <div class="progress-text" id="progressText" style="display:none;">进度: 0%</div>
  </div>

  <script>
    function showContent(sectionId) {
      document.querySelectorAll('.section').forEach(sec => sec.classList.add('hidden'));
      document.getElementById(sectionId).classList.remove('hidden');
    }

    // Simulated OTA push to activate "检查更新"
    const checkBtn = document.getElementById('checkUpdateBtn');
    const simulateBtn = document.getElementById('simulateOtaBtn');

    simulateBtn.onclick = function() {
      activateCheckUpdate();
      alert("模拟 OTA 推送任务已到达，可以点击“检查更新”查看详情。");
    };

    function activateCheckUpdate() {
      checkBtn.disabled = false;
      checkBtn.classList.remove('btn-disabled');
      checkBtn.classList.add('btn-active');
      checkBtn.onclick = openUpdateModal;
    }

    function openUpdateModal() {
      document.getElementById('modal').style.display = 'block';
      // In real flow, fetch('/task_info'); here we simulate content
      const info = {
        client: "Client_1",
        current_version: "v1.0.0",
        target_version: "v1.1.0",
        changelog: ["修复已知问题", "优化网络稳定性", "提升下载性能"]
      };
      document.getElementById('taskInfo').innerText = JSON.stringify(info, null, 2);
    }

    function closeModal() {
      document.getElementById('modal').style.display = 'none';
      resetProgressUI();
    }

    function onDeny() {
      alert("用户拒绝升级");
      closeModal();
    }

    function onAccept() {
      // Start dual-color progress (green fill grows; container gray is remaining)
      document.getElementById('progressContainer').style.display = 'block';
      document.getElementById('progressText').style.display = 'block';
      startProgressSimulation20s();
    }

    function resetProgressUI() {
      const fill = document.getElementById('progressFill');
      const text = document.getElementById('progressText');
      const container = document.getElementById('progressContainer');
      fill.style.width = "0%";
      text.innerText = "进度: 0%";
      container.style.display = 'none';
      text.style.display = 'none';
    }

    // Simulate 20s progress to 100%
    function startProgressSimulation20s() {
      const fill = document.getElementById('progressFill');
      const text = document.getElementById('progressText');
      let progress = 0;
      const steps = 20;       // 20 seconds
      const increment = 100 / steps;
      const interval = setInterval(() => {
        progress = Math.min(100, progress + increment);
        fill.style.width = progress + "%";
        text.innerText = "进度: " + Math.round(progress) + "%";
        if (progress >= 100) {
          clearInterval(interval);
          setTimeout(() => {
            alert("升级成功！");
            closeModal();
          }, 300);
        }
      }, 1000);
    }
  </script>
</body>
</html>
